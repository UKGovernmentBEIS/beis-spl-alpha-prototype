{% from "radios/macro.njk" import govukRadios %}
{% from "summary-list/macro.njk" import govukSummaryList %}
{% import "data-macros.njk" as dataMacros %}

{% extends "layout.html" %}

{% block pageTitle %}
  Plan leave and pay when you have a child
{% endblock %}

{% set dueDate %}
  {{ dataMacros.dueDate(data) }}
{% endset %}

{% block content %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <h1 class="govuk-heading-xl">
        Plan leave and pay when you have a child
      </h1>
      <p class="smart-planner-hide">
        Use the calendar below to plan maternity, paternity and shared parental leave weeks around your child's expected birth week or placement date.
      </p>
      <p class="smart-planner-hide">
        Shared parental leave is created from any unused maternity leave. The mother and the father can take three blocks of shared parental leave each.
        They can take this leave separately, or together.
      </p>
      <p class="smart-planner-show">
        Use the calendar below to select the weeks you and your partner would like to take off work when you're having a child.
      </p>
      <p class="smart-planner-show">
        The planner will work out the most suitable type of leave based on who is taking time off, when itâ€™s being taken and how many weeks you want to take.
      </p>
      {{ govukRadios({
        classes: "govuk-radios--inline",
        idPrefix: "leave-type",
        name: "leave-type",
        fieldset: {
          classes: "smart-planner-hide",
          legend: {
            text: "Type of leave",
            isPageHeading: false,
            classes: "govuk-fieldset__legend--s"
          }
        },
        items: [
          {
            value: "not-shared",
            text: "Maternity / Paternity leave",
            checked: true
          },
          {
            value: "shared",
            text: "Shared parental leave"
          }
        ]
      }) }}
    </div>
  </div>
  <div class="govuk-grid-row">
    <div id="leave-calendar-container" class="govuk-grid-column-two-thirds govuk-!-margin-bottom-6">
      <table id="leave-calendar" class="govuk-table">
        <thead class="govuk-table__head">
          <tr class="govuk-table__row">
            <th class="govuk-table__header" scope="col"></th>
            <th class="govuk-table__header" scope="col">Mother</th>
            <th class="govuk-table__header" scope="col">Partner</th>
          </tr>
        </thead>
        <tbody class="govuk-table__body">
          {% for i in range(-11, 51) %}
            {% if (i === 0) %}
              <tr class="birth-week">
                <td></td>
                <td colspan="2">
                  Birth week
                </td>
              </tr>
            {% endif %}
            {% set beforeBirthWeek = i < 0 %}
            {% set firstTwoBirthWeeks = (i === 0) or (i === 1) %}
            <tr class="govuk-table__row leave-week">
              <td class="govuk-table__cell">
                {{ dueDate | trim | startOfWeek | offsetWeeks(i) | formatDate("DD MMM") }}
              </td>
              <td data-week="{{i}}"
                  class="govuk-table__cell mother {% if beforeBirthWeek %}before-birth-week{% endif %} {% if firstTwoBirthWeeks %}compulsory maternity disabled{% endif %}">
              </td>
              <td data-week="{{i}}" class="govuk-table__cell partner {% if beforeBirthWeek %}disabled{% endif %}"></td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="govuk-grid-column-one-third">
      <h2 class="govuk-heading-m">
        Leave weeks
      </h2>
      <p>Any unused maternity leave can be taken as shared parental leave.</p>
      <p>Paternity leave is separate.</p>
      {{ govukSummaryList({
        rows: [
          {
            key: {
              text: "Maternity"
            },
            value: {
              html: '<span id="maternity-weeks"></span> weeks'
            }
          },
          {
            key: {
              text: "Shared"
            },
            value: {
              html: '<span id="shared-weeks"></span> weeks'
            }
          },
          {
            key: {
              classes: "remaining-total",
              text: "Remaining"
            },
            value: {
              classes: "remaining-total",
              html: '<span id="remaining-weeks"></span> weeks'
            }
          }
        ]
      }) }}
      <div class="leave-messages">
        <p id="maternity-gap" class="govuk-body-s warning">
          You cannot leave a gap in your maternity leave.
        </p>
        <p id="maternity-maximum" class="govuk-body-s warning">
          You have taken more than the maximum of 52 weeks maternity or shared parental leave.
        </p>
        <p id="shared-before-maternity" class="govuk-body-s warning">
          You cannot take shared parental leave before maternity leave has started.
        </p>
        <p id="no-more-shared" class="govuk-body-s info">
          You have no more shared parental leave, reduce your maternity leave to create more.
        </p>
        <p id="can-break-shared" class="govuk-body-s info">
          Remember, you can break up shared parental leave with periods of work.
        </p>
      </div>
      {{ govukSummaryList({
        rows: [
          {
            key: {
              text: "Paternity"
            },
            value: {
              html: '<span id="paternity-weeks"></span> weeks'
            }
          }
        ]
      }) }}
      <div class="leave-messages">
        <p id="paternity-gap" class="govuk-body-s warning">
          You cannot leave a gap in your paternity leave.
        </p>
        <p id="paternity-maximum" class="govuk-body-s warning">
          You have taken more than the maximum of 2 weeks paternity leave.
        </p>
        <p id="paternity-period" class="govuk-body-s warning">
          You can only take paternity leave in the first 8 weeks after the birth.
        </p>
      </div>
    </div>
  </div>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <h2 class="govuk-heading-l">Key dates</h2>
      {% set dueDateLong %}
        {{ dueDate | trim | startOfWeek | formatDate("DD MMMM YYYY") }}
      {% endset %}
      {% set notifyEmployersDate %}
        {{ dueDate | trim | offsetWeeks(-15) | formatDate("DD MMMM YYYY") }}
      {% endset %}
      {{ govukSummaryList({
        rows: [
          {
            key: {
              text: "Baby is due"
            },
            value: {
              text: dueDateLong
            }
          },
          {
            key: {
              text: "Notify employers of maternity leave"
            },
            value: {
              text: "by " + notifyEmployersDate
            }
          }
        ]
      }) }}
      <p>
        Continue with these dates and generate leave notices.
      </p>
      <form action="planner/mothers-name">
        <input id="mother-shared" name="mother-shared" type="hidden" value="0">
        <input id="partner-shared" name="partner-shared" type="hidden" value="0">
        <button type="submit" class="govuk-button">
          Save and continue
        </button>
      </form>
    </div>
  </div>

{% endblock %}
